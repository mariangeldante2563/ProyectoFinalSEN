<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Administrador Avanzado - IN OUT MANAGER</title>
  <meta name="description" content="Panel de administraci√≥n avanzado para el sistema IN OUT MANAGER">
  <meta name="keywords" content="dashboard, administrador, analytics, reports, IN OUT MANAGER">
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="IN OUT Admin">
  <link rel="manifest" href="../../manifest.json">
  
  <!-- Precargar recursos cr√≠ticos -->
  <link rel="preload" href="../../assets/img/icon.jpg" as="image">
  <link rel="preload" href="../../assets/css/styles.css?v=20250924001" as="style">
  <link rel="preload" href="../../assets/css/admin-dashboard-advanced.css?v=20250924001" as="style">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="../../assets/css/styles.css?v=20250924001">
  <link rel="stylesheet" href="../../assets/css/footer-styles.css?v=20250924001">
  <link rel="stylesheet" href="../../assets/css/dashboard.css?v=20250924001">
  <link rel="stylesheet" href="../../assets/css/admin-dashboard-advanced.css?v=20250924001">
  <link rel="icon" type="image/jpeg" href="../../assets/img/icon.jpg">
  
  <!-- External Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/index.min.js"></script>
  
  <!-- Core Scripts como m√≥dulos ES6 -->
  <script type="module" src="../../assets/js/api-service.js"></script>
  <script type="module" src="../../assets/js/session-manager.js"></script>
  <script type="module" src="../../assets/js/path-manager.js"></script>
  
  <!-- Script de inicializaci√≥n del dashboard -->
  <script type="module">
    import PathManager from '../../assets/js/path-manager.js';
    import SessionManager from '../../assets/js/session-manager.js';
    
    // Verificar autenticaci√≥n al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üöÄ Dashboard Admin: Iniciando verificaci√≥n...');
      
      // Debuggear rutas inmediatamente
      PathManager.debugPaths();
      
      // Verificar que el usuario est√© autenticado
      const userData = SessionManager.getUserData();
      if (!userData) {
        console.warn('‚ö†Ô∏è Dashboard Admin: Usuario no autenticado');
        PathManager.navigateToLogin('Debe iniciar sesi√≥n para acceder al dashboard.');
        return;
      }
      
      if (userData.tipo !== 'administrador') {
        console.warn('‚ö†Ô∏è Dashboard Admin: Usuario sin permisos de administrador');
        PathManager.navigateToLogin('Acceso denegado. Debe ser administrador.');
        return;
      }
      
      console.log('‚úÖ Dashboard Admin: Usuario autenticado como administrador:', userData.nombre);
      
      // Actualizar nombre del administrador en la interfaz
      const adminNameElement = document.getElementById('adminName');
      if (adminNameElement) {
        adminNameElement.textContent = userData.nombre;
      }
      
      try {
        // Cargar m√≥dulos del dashboard din√°micamente con PathManager mejorado
        console.log('üì¶ Dashboard Admin: Cargando m√≥dulos...');
        
        const modules = [
          'charts-manager.js',
          'real-time-manager.js', 
          'reports-manager.js',
          'audit-manager.js',
          'backup-manager.js'
        ];
        
        // Cargar m√≥dulos uno por uno para mejor control de errores
        for (const module of modules) {
          try {
            await PathManager.loadModule(module);
            console.log(`‚úÖ M√≥dulo cargado: ${module}`);
          } catch (error) {
            console.error(`‚ùå Error cargando ${module}:`, error);
            // Continuar con otros m√≥dulos
          }
        }
        
        // Cargar el controlador principal del dashboard
        console.log('üéØ Dashboard Admin: Cargando controlador principal...');
        await PathManager.loadModule('admin-dashboard-advanced.js');
        
        console.log('üéâ Dashboard Admin: Inicializaci√≥n completada');
        
        // Mostrar mensaje de bienvenida
        const welcomeDiv = document.createElement('div');
        welcomeDiv.className = 'welcome-message';
        welcomeDiv.innerHTML = `
          <div style="background: #28a745; color: white; padding: 10px; border-radius: 5px; margin: 10px; text-align: center;">
            ‚úÖ Dashboard cargado correctamente. Bienvenido/a ${userData.nombre}
          </div>
        `;
        document.body.insertBefore(welcomeDiv, document.body.firstChild);
        
        // Quitar mensaje despu√©s de 3 segundos
        setTimeout(() => {
          welcomeDiv.remove();
        }, 3000);
        
      } catch (error) {
        console.error('‚ùå Dashboard Admin: Error cr√≠tico:', error);
        
        // Mostrar error en la interfaz
        const errorDiv = document.createElement('div');
        errorDiv.innerHTML = `
          <div style="background: #dc3545; color: white; padding: 20px; margin: 20px; border-radius: 5px; text-align: center;">
            <h3>‚ùå Error cargando el Dashboard</h3>
            <p>Error: ${error.message}</p>
            <button onclick="location.reload()" style="background: white; color: #dc3545; border: none; padding: 10px 20px; border-radius: 3px; cursor: pointer;">
              üîÑ Recargar P√°gina
            </button>
          </div>
        `;
        document.body.appendChild(errorDiv);
      }
    });
    
    // Configurar logout
    document.addEventListener('DOMContentLoaded', () => {
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
          console.log('üö™ Dashboard Admin: Cerrando sesi√≥n...');
          SessionManager.logout();
          PathManager.navigateToLogin('Sesi√≥n cerrada correctamente.');
        });
      }
    });
  </script>
</head>

<body>
  <!-- INICIO DEL HEADER Y NAVEGACI√ìN PRINCIPAL -->
  <header class="site-header">
    <div class="header-title">
      <h1>IN OUT MANAGER</h1>
      <button id="mobileMenuToggle" class="mobile-menu-toggle" aria-label="Abrir men√∫">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
    </div>
    <nav class="main-nav" aria-label="Navegaci√≥n principal">
      <ul id="mainNavList" class="nav-menu-list">
        <li class="nav-logo">
          <img src="../../assets/img/icon.jpg" alt="Logo de IN OUT MANAGER" class="icon" loading="eager">
        </li>
        <li class="nav-items-container">
          <ul class="nav-items-group">
            <li class="nav-item"><a href="../../proyectopages/index.html#tecnologias" class="nav-btn btn-animated">Tecnolog√≠as</a></li>
            <li class="nav-item"><a href="../../proyectopages/index.html#nosotros" class="nav-btn btn-animated">Sobre Nosotros</a></li>
            <li class="nav-item"><a href="../../proyectopages/index.html#portfolio" class="nav-btn btn-animated">Portfolio</a></li>
            <li class="nav-item"><a href="../../proyectopages/index.html#contacto" class="nav-btn btn-animated">Contacto</a></li>
          </ul>
        </li>
        <li class="auth-buttons-container">
          <button id="logoutBtn" class="nav-btn auth-btn logout-btn btn-animated">Cerrar Sesi√≥n</button>
        </li>
      </ul>
    </nav>
  </header>

  <!-- FIN DEL HEADER Y NAVEGACI√ìN PRINCIPAL -->
 

  <!-----------------------DASHBOARD ADMINISTRADOR AVANZADO --------------------->
  <main class="admin-main">
    <!-- Dashboard Header Avanzado -->
    <section class="admin-header-section">
      <div class="admin-header-container">
        <div class="admin-welcome">
          <div class="admin-avatar">
            <img id="adminAvatar" src="../../assets/img/default-admin.png" alt="Admin Avatar" class="avatar-img">
            <div class="status-indicator online"></div>
          </div>
          <div class="admin-info">
            <h1 class="admin-title">Dashboard Administrativo</h1>
            <p class="admin-subtitle">Bienvenido/a <span id="adminName">Administrador</span></p>
            <div class="admin-metadata">
              <span class="metadata-item"><i class="fas fa-building"></i> <span id="adminDepartment">Sistemas</span></span>
              <span class="metadata-item"><i class="fas fa-clock"></i> <span id="currentDateTime">--</span></span>
            </div>
          </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
          <button class="quick-action-btn" id="realTimeToggle" title="Vista en Tiempo Real">
            <i class="fas fa-broadcast-tower"></i>
            <span class="indicator active"></span>
          </button>
          <button class="quick-action-btn" id="notificationsBtn" title="Notificaciones">
            <i class="fas fa-bell"></i>
            <span class="badge" id="notificationsBadge">3</span>
          </button>
          <button class="quick-action-btn" id="backupBtn" title="Backup">
            <i class="fas fa-download"></i>
          </button>
          <button class="quick-action-btn" id="settingsBtn" title="Configuraci√≥n">
            <i class="fas fa-cog"></i>
          </button>
        </div>
      </div>
    </section>

    <!-- KPIs Dashboard -->
    <section class="kpis-section">
      <div class="kpis-container">
        <div class="kpi-card" data-kpi="employees">
          <div class="kpi-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="totalEmployees">--</div>
            <div class="kpi-label">Total Empleados</div>
            <div class="kpi-trend positive">
              <i class="fas fa-arrow-up"></i>
              <span id="employeesTrend">+5%</span>
            </div>
          </div>
        </div>

        <div class="kpi-card" data-kpi="attendance">
          <div class="kpi-icon">
            <i class="fas fa-user-check"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="todayAttendance">--</div>
            <div class="kpi-label">Asistencia Hoy</div>
            <div class="kpi-trend positive">
              <i class="fas fa-arrow-up"></i>
              <span id="attendanceTrend">+2%</span>
            </div>
          </div>
        </div>

        <div class="kpi-card" data-kpi="productivity">
          <div class="kpi-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="productivityScore">--</div>
            <div class="kpi-label">Productividad</div>
            <div class="kpi-trend neutral">
              <i class="fas fa-minus"></i>
              <span id="productivityTrend">0%</span>
            </div>
          </div>
        </div>

        <div class="kpi-card" data-kpi="alerts">
          <div class="kpi-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="activeAlerts">--</div>
            <div class="kpi-label">Alertas Activas</div>
            <div class="kpi-trend negative">
              <i class="fas fa-arrow-down"></i>
              <span id="alertsTrend">-10%</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Dashboard Grid -->
    <section class="dashboard-grid-section">
      <div class="dashboard-grid">
        
        <!-- Panel de Control en Tiempo Real -->
        <div class="dashboard-panel realtime-panel" id="realtimePanel">
          <div class="panel-header">
            <h3><i class="fas fa-broadcast-tower"></i> Vista en Tiempo Real</h3>
            <div class="panel-controls">
              <div class="status-indicator active"></div>
              <span class="status-text">En Vivo</span>
              <button class="panel-control-btn" id="refreshRealtime">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
          <div class="panel-content">
            <div class="realtime-stats">
              <div class="realtime-stat">
                <span class="stat-value" id="employeesWorking">--</span>
                <span class="stat-label">Trabajando Ahora</span>
              </div>
              <div class="realtime-stat">
                <span class="stat-value" id="recentActions">--</span>
                <span class="stat-label">Acciones Recientes</span>
              </div>
            </div>
            <div class="realtime-feed" id="realtimeFeed">
              <!-- Feed en tiempo real se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Gesti√≥n de Empleados Avanzada -->
        <div class="dashboard-panel employees-panel" id="employeesPanel">
          <div class="panel-header">
            <h3><i class="fas fa-users-cog"></i> Gesti√≥n de Empleados</h3>
            <div class="panel-controls">
              <button class="panel-control-btn" id="addEmployeeBtn">
                <i class="fas fa-user-plus"></i> Nuevo
              </button>
              <button class="panel-control-btn" id="bulkActionsBtn">
                <i class="fas fa-tasks"></i> Acciones
              </button>
            </div>
          </div>
          <div class="panel-content">
            <div class="employees-filters">
              <div class="filter-group">
                <input type="text" id="employeeSearchInput" placeholder="Buscar empleados..." class="search-input">
                <select id="departmentFilter" class="filter-select">
                  <option value="">Todos los departamentos</option>
                  <option value="sistemas">Sistemas</option>
                  <option value="rrhh">RRHH</option>
                  <option value="operaciones">Operaciones</option>
                </select>
                <select id="statusFilter" class="filter-select">
                  <option value="">Todos los estados</option>
                  <option value="active">Activos</option>
                  <option value="inactive">Inactivos</option>
                  <option value="working">Trabajando</option>
                </select>
              </div>
            </div>
            <div class="employees-table-container">
              <table class="employees-table" id="employeesTable">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="selectAllEmployees"></th>
                    <th>Empleado</th>
                    <th>Departamento</th>
                    <th>Estado</th>
                    <th>√öltima Actividad</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="employeesTableBody">
                  <!-- Se llenar√° din√°micamente -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Analytics y Gr√°ficos -->
        <div class="dashboard-panel analytics-panel" id="analyticsPanel">
          <div class="panel-header">
            <h3><i class="fas fa-chart-bar"></i> An√°lisis de Productividad</h3>
            <div class="panel-controls">
              <select id="analyticsTimeframe" class="control-select">
                <option value="day">Hoy</option>
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mes</option>
                <option value="quarter">Trimestre</option>
              </select>
            </div>
          </div>
          <div class="panel-content">
            <div class="charts-container">
              <div class="chart-wrapper">
                <canvas id="attendanceChart" class="dashboard-chart"></canvas>
              </div>
              <div class="chart-wrapper">
                <canvas id="productivityChart" class="dashboard-chart"></canvas>
              </div>
            </div>
            <div class="analytics-insights" id="analyticsInsights">
              <!-- Insights se generar√°n din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Reportes Avanzados -->
        <div class="dashboard-panel reports-panel" id="reportsPanel">
          <div class="panel-header">
            <h3><i class="fas fa-file-chart-line"></i> Reportes Avanzados</h3>
            <div class="panel-controls">
              <button class="panel-control-btn" id="generateReportBtn">
                <i class="fas fa-plus"></i> Generar
              </button>
              <button class="panel-control-btn" id="scheduleReportBtn">
                <i class="fas fa-calendar-alt"></i> Programar
              </button>
            </div>
          </div>
          <div class="panel-content">
            <div class="reports-filters">
              <div class="filter-row">
                <select id="reportType" class="filter-select">
                  <option value="">Tipo de Reporte</option>
                  <option value="attendance">Asistencia</option>
                  <option value="productivity">Productividad</option>
                  <option value="audit">Auditor√≠a</option>
                  <option value="custom">Personalizado</option>
                </select>
                <input type="date" id="reportStartDate" class="filter-input">
                <input type="date" id="reportEndDate" class="filter-input">
                <button id="applyReportFilters" class="apply-filters-btn">Aplicar</button>
              </div>
            </div>
            <div class="reports-list" id="reportsList">
              <!-- Lista de reportes se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Panel de Auditor√≠a -->
        <div class="dashboard-panel audit-panel" id="auditPanel">
          <div class="panel-header">
            <h3><i class="fas fa-shield-alt"></i> Auditor√≠a y Seguridad</h3>
            <div class="panel-controls">
              <div class="security-status">
                <span class="security-level high">Alto</span>
              </div>
            </div>
          </div>
          <div class="panel-content">
            <div class="audit-timeline" id="auditTimeline">
              <!-- Timeline de auditor√≠a se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Configuraci√≥n del Sistema -->
        <div class="dashboard-panel settings-panel" id="settingsPanel">
          <div class="panel-header">
            <h3><i class="fas fa-cogs"></i> Configuraci√≥n del Sistema</h3>
          </div>
          <div class="panel-content">
            <div class="settings-categories">
              <div class="setting-category">
                <h4><i class="fas fa-database"></i> Base de Datos</h4>
                <div class="setting-item">
                  <span>Estado de Conexi√≥n</span>
                  <div class="status-indicator online"></div>
                </div>
                <div class="setting-item">
                  <span>√öltimo Backup</span>
                  <span id="lastBackupTime">--</span>
                </div>
              </div>
              <div class="setting-category">
                <h4><i class="fas fa-bell"></i> Notificaciones</h4>
                <div class="setting-item">
                  <span>Alertas en Tiempo Real</span>
                  <label class="toggle-switch">
                    <input type="checkbox" id="realTimeAlertsToggle" checked>
                    <span class="slider"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Modales y Overlays -->
    <div id="modalOverlay" class="modal-overlay">
      <!-- Los modales se cargar√°n din√°micamente -->
    </div>

    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container">
      <!-- Notificaciones toast aparecer√°n aqu√≠ -->
    </div>
  </main>


  <!-- INICIO FOOTER SIMPLE DE REDES SOCIALES  -->
  
  <footer class="site-footer">
    <div class="social-footer-container">
      <div class="social-media-footer">
        <a href="#" class="social-icon-footer" aria-label="Facebook">
          <img src="../../assets/img/facebook.jpg" alt="Facebook" class="social-img">
        </a>
        <a href="#" class="social-icon-footer" aria-label="Instagram">
          <img src="../../assets/img/instagram.jpg" alt="Instagram" class="social-img">
        </a>
        <a href="#" class="social-icon-footer" aria-label="TikTok">
          <img src="../../assets/img/tiktok.jpg" alt="TikTok" class="social-img">
        </a>
        <a href="mailto:info@inoutmanager.com" class="social-icon-footer" aria-label="Correo">
          <i class="fas fa-envelope email-icon"></i>
        </a>
      </div>
      <p class="copyright-text">¬© 2025 IN OUT MANAGER</p>
    </div>
  </footer>

  <!-- FIN: FOOTER SIMPLE DE REDES SOCIALES     -->


</body>
</html>
